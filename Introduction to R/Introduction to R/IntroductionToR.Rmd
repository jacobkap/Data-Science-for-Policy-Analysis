---
output: 
  pdf_document:
    citation_package: natbib
    fig_caption: true
    latex_engine: pdflatex
    template: "C:/Users/nellim/Box Sync/Introduction to R/svm-latex-ms.tex"
title: "Introduction to R"
author:
- name: Nelson Lim, Samantha Sangenito
- affiliation: Fels Institute of Government
- affiliation: University of Pennsylvania
date: "`r format(Sys.time(), '%B %d, %Y')`"
geometry: margin=1in
fontfamily: mathpazo
fontsize: 11pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Bottom Line Up Front (BLUF)

This handout introduces R. You can use R as a software like Microsoft Excel. But R can do a lot more. This handout will help you start reasoning with data.

# Proper Mindset for Learning R

Learning R is not like learning how to use Microsoft Word. You are learning to compose a set of instructions to communicate with a computer; you are not learning to execute a series of standardized tasks. To accomplish this, you need to adopt a proper mindset.

## Be curious

Learning R is rewarding but difficult. You will not immediately experience a tangible reward for your hard work, even though the reward is there waiting for you. When you successfully execute your R codes, you experience a feeling of satisfaction that only creators like composers, poets, or writers experience. 

By learning R, you are training your brain to do something new. Neurologists tell us that when we are learning new skill, your brain is making new connections among neurons. The dense networks of neurons are associated with creativity. So be curious. 

## Be patient

You learn R just like you learn a foreign language. You learn by using it. You need to learn its grammar, vocabulary, and expressions. In the beginning, you will find it awkward and frustrating. Moreover, unlike communicating with a human, you are communicating with a computer. Computers are very literal and adhere to strict rules. For a computer ` is not the same as '. Similarly, a computer doesn't know that MAINE and Maine are the same. A computer will not follow your instruction, until you give the instruction exactly the way it is expecting. 

Because it is difficult, you may often feel like giving up. You will feel that you are wasting your time. You will come up with reasons to give up. Resist those negative thoughts. We, Samantha and I, have introduced R to students with little or no background in computer programming and statistics. In fact many of them have internalized that they are "not good with math". But we have witnessed them learn R and do incridible projects. So don't give up; be patient.

## Be persistent

It is extremely unlikely that the codes you write will run without generating errors. Some of the errors are difficult to comprehend. Error messages in R is infamous for their uselessness. They are often written by advance users for advance users. For us they often are impossible to comprehend. Google is an invaluable resource to find solutions, because R users are very active and happy to assist each others. But you may not find what you are looking for right away. So you need to be persistent.

# Resources

There are many useful resources to learn R. In fact, there are too many resources that they can be overwhelming. So it is wise to invest in reliable references. Here are three references that you should acquire for your learning journey.

1. *R in Action: Data Analysis and Graphics with R* by Robert I. Kabacoff. If you are going to buy only one book to learn R, get this book. Even though it doesn't cover latest features of R, it has everything you need to get you started. 

2. *R for Data Science* by Hadley Wickham and Garrett Grolemund. This book is written by one of the most influential R programmers, Hadley Wickham. He has developed many popular R packages. In this book, he introduces a new paradigm for R users. Therefore, this book is a unique and innovative book. 

3. *Quantitative Social Science: An Introduction* by Kosuke Imai. This book offers a rigorous introduction to the latest thinking on how to reason with data. It also teaches you how to use R.  

# Important House Keeping Items

This handout assumes that you have installed the latest version of R and R Studio. If you have not installed those software packages, please do so now. You can download the packages by googling *R* and *R Studio*. 

If you need further assistance, you can watch videos showing how to install these software packages. Samantha recorded a video. You can also get instructional videos from *youtube*. Just search by entering key words: *how to install R*.

## R is command-driven 

Most of the software packages you have used are menu-based. R is command-driven. You have to type a series of instructions (commands) in text, which is called a script, and ask R to execute it. Samantha recorded a video showing how you compose a script and execute the commands in R Studio. 

## Installing and Loading Packages

The standard (or core) R you installed already is a very powerful software. You can expand its power by using packages that are developed and freely shared by R users. R studio provides easy ways to install packages. You can also install packages using `install.packages()`. For example, `install.packages("ggplot2")`. And once a package is installed, you can load a package using `library()`. For example, `library(ggplot2)`.

You will get an error message, if you try to use a command (or a function) from a package without loading the associated package first. **This is one of the most common errors you will get as a new user of R. Make sure to load the packages you need at the front of your script.**

## Setting a Working Directory

**This is another one of the most common errors. You need to master this concept to avoid unnessary heart ache.** 

Your working directory is a location on your computer where R will look for your data and scripts. You will need to tell R what your working directory is everytime you open RStudio, otherwise R will just guess. **You don't want R to guess.**

To find out what R has currently set as your working directory, you write this code: `getwd()`.

When I **run** the above code, R show me my current working directory is.
```{r}
getwd()
```

#----------------------------
#Your Turn: Run the above code in your R console to find out your working directory. 
#----------------------------

Check out the pathway that prints out in your console. This pathway is *unique* to your computer. Notice that R uses forward slash.

It is a best practice to create a folder for your R data and tell R to use that folder every time you open R using `setwd()`.

Here's how I set the pathway that I would like to use as the working directory.
```{r}
setwd("C:/Users/nellim/Box Sync/Introduction to R")
```

#-----------------------------
# Your turn: Can you edit my setwd() code to set your own working directory?
#-----------------------------


# Types of data in R

You can use R to work with many types of data. The most common type of data you will work with is something called a dataframe. This is very similar to an Excel spreadsheet in appearance.

## Creating a dataframe
There are two ways to create a dataframe in R, you can either make one yourself or read in a pre-made data file. Most of the time we will read in an external file. This tutorial will show you how to do both. 

### Making a dataframe 
Let's make one so you can see.

```{r}
# beatles is the name of the dataframe
beatles <- data.frame(
  name = c("John", "Paul", "George", "Ringo"),
  birth = c(1940, 1942, 1943, 1940), 
  instrument = c("guitar", "bass", "guitar", "drums")
)
```

Note the sentence starts with `#`. It is a comment. When you start a sentence with `#`, R ignores it. You should write a lot of comments in your script. This is an essential habit of a good analyst. 

Note also how we *assign* the dataframe to be `beatles` using `<-`. Note also that we created a dataframe with 3 columns: name, birth, and instrument, then populated those columns with information inside the function: `c()`. Now you can ask R to get this dataframe using that name `beatles`. 

Columns in the dataframe are called *variables*; rows in the dataframe are called *observations*. 

You can see what is in your dataframe with View()
```{r}
View(beatles)
```

You can also *print* what is in your dataframe by executing the name of the dataframe. 
```{r}
beatles
```
You should only use this option to view the dataframe, when it is relatively small. You don't want to do this for large dataframe. For a large dataframe, you can print the first top 10 observations of the dataframe by executing `head(mydata, n=10)`. `mydata` is a generic name of the dataframe. 

#-----------------------------
# Your turn: Make your own dataframe that contains information on the band Aerosmith from the following data on instrument, birth year, and marital status for each member:
```
Steven Tyler, lead vocals, born 1948, single
Joe Perry, guitar, born 1950, married
Tom Hamilton,  bass, 1951, married
Joey Kramer, drums, 1950, married
Brad Whitford, guitar, born 1952, married
```
#-----------------------------

### Saving and loading a dataframe 

Now that we have created a data frame, we can save it.

```{r}
# the format for the command to save a data frame in a file is:
# save(xxx, file = "yyy.RData")
# xxx = the object name
# yyy = the file name
save(beatles, file = "beatles.RData")
```

Once you save a file, you can load it when you need it.

```{r}
load("beatles.RData")
```

### Managing data frame
Now that you have a data frame, you can select different elements of the data frame to examine and change. Each element of the data frame has an "address". **The "address" structure is one of most important concepts to master as a new user of R. You may find it confusing at first.**

Table: "Address" of each element in a data frame

|      | [,1]  | [,2]  | [,3]  |
|------|-------|-------|-------|
| [1,] | [1,1] | [1,2] | [1,3] |
| [2,] | [2,1] | [2,2] | [2,3] |
| [3,] | [3,1] | [3,2] | [3,3] |

Using these "addresses" to select the elements that you are interested.

```{r}
# you can select a column of a data frame
# for example, select names of the Beatles
beatles$name
# you can do the same task differently
beatles[,1] 
# note how the variable "name", the first column of the data frame, 
# beatles, is selected without using the variable name

# you can also select a particular member of the Beatles
beatles[1,]
beatles[beatles$name=="John",]
```

#-----------------------------
# Your turn: 
# (1) Print the names of Aerosmith's members
# (2) Print information about a member of Aerosmith
#-----------------------------


### Reading in a data file 
In most cases, you are not going to manually enter the data like you did above. The data you need are already stored in a file. The function for reading in a data file will differ depending on the type of file you are reading. In this example, we will use a comma-separated values (csv). You can import a csv file using `read.csv`.

Here we are reading in the csv file, `Philly_schools.csv`. This dataset contains information on public schools in Philadelphia. Each row represents 1 school. 

```{r}
# importing data
library(foreign)
schools <- read.csv("Philly_schools.csv", stringsAsFactors = FALSE)
# we print top 3 observations to take a look
head(schools, n=3)
```

Note that we use a command `read.csv` from a package called `foreign`. We also turn on an option `stringsAsFactors = FALSE`. This code tells R not to convert character variables into factors. Just make a mental note for now. We talk more about this below.  

# Working with Variables

Conceptually there are two types of variables: categorical and continuous. (We are over simplifying for this handout.) Categorical variables are associated with, you guess it, categories like gender, race, college major, academic degrees, ranks. Continous variables are associated with measures with many (or infinite) values like age, income, wage, or body weight.  

There are three main classifications for variables in R:character, factor, and numeric. The first two classes are associated with categorical data. There are two types of categorical data: nominal and ordinal. We will discuss the types later. 

Table: Relationship between conceptual types and classification of variable

| Types            | Sub-type  | Classification   |
|------------------|-----------|------------------|
| Categorical data | Nominal   | Character        |
|                  | Ordinal   |                  |
|                  | Nominal   | Factor           |
|                  | Orinal    |                  |
| Continuous       |           | Numeric          |


## Character variables
Character variables are just text. In the schools dataframe, the SCHOOL_NAME_1 variable is a character. It is just the name of the school.

We can check to see if a variable is a character by executing this code: `class(schools$SCHOOL_NAME_1)`.

```{r}
# what is the "class" of SCHOOL_NAME_1
class(schools$SCHOOL_NAME_1)
```

Here we are asking R to give us the class type of the column for school name inside the dataframe, schools. This `dataframe$columnname` syntax will become quite familiar to you in time! 

### Alternative way to select a variable from a data frame
The attach() function allows us to simplify our code by removing the need to refer to the name of the dataframe 

For example: `
```{r}
attach(schools)
class(schools$SCHOOL_NAME_1)
```
Notice that the function is working without the dataframe$column name syntax.

## Factor Variables
Factors are a special type of variable. They will appear in a dataframe as either character or numeric, but they have some additional information associated with them that is hidden to us, but that R uses. Factor levels control how variables are graphed, displayed in tables, and matter for interpreting regressions. We'll discuss factors in greater detail later on. 

`SCHOOL_LEVEL_NAME` is currently a character variable.
```{r}
# what is the class of SCHOOL_LEVEL_NAME
class(schools$SCHOOL_LEVEL_NAME)
```

Now we can change this variable to a factor variable.
```{r}
# change a character variable into a factor
schools$SCHOOL_LEVEL_NAME <- as.factor(schools$SCHOOL_LEVEL_NAME)
```

Check that this variable is now a factor
```{r}
class(schools$SCHOOL_LEVEL_NAME)
```

You can examine the levels for a factor variable.
```{r}
levels(schools$SCHOOL_LEVEL_NAME)
```

We'll see how R uses these levels later on in this script.

## Numeric Variables
Numeric variables are just numbers. The variable, `Average_salary`, is the average salary of teachers in each school. 
```{r}
# what is the class of Average_salary
class(schools$Average_salary)
```

# Basic Data Manipulation

To get us familiar with working in R, we will learn some basic functions commonly applied to character and numeric variables

## Working with character data

### Print an alphabetized list with `sort()`
```{r}
listofschools <- sort(schools$SCHOOL_NAME_1)
# the list is too long
# we will only print the names of the first 10 schools
head(listofschools, n=10)
```
### The table functions provides us a count of character variables
```{r}
table(schools$SCHOOL_LEVEL_NAME)
```

## Working with numeric data

With numeric data, you can compute simple summary (or descriptive) statistics using `mean()` and `summary`.
```{r}
# mean value of number of suspensions in Philly public schools
mean(schools$Total_suspensions)
# alternative way to get similar summary statistics
summary(schools$Total_suspensions)
```

### Creating new variables using arithmetic operators
```{r}
# creating a new variable, NewEnrollmentProp, using two existing variables: New_student and Enrollment
schools$NewEnrollmentProp <- (schools$New_student / schools$Enrollment)*100
summary(schools$NewEnrollmentProp)
```

### Aggregating numeric variables by categories of character variable
```{r}
class(schools$Total_suspensions)
class(schools$SCHOOL_LEVEL_NAME)
#compute average number of total suspension by school level
aggregate(schools$Total_suspensions, by=list(schools$SCHOOL_LEVEL_NAME), FUN=mean)
```

#------------------------
# Your turn: 
#(1) Look in the dataframe schools, and find two examples of categorical and continuous variables.
#(2) Find the average teacher salary in Philadelphia 
#(3) Find the average teacher salary in Philadelphia by school level
#------------------------


# Graphing different Types of variables

R is wellknown for its capability to produce effective vitualization of the data. We will show you how to use core graphical commands in R. In the Spring, we will show you how to use *ggplot* and other packages that are more powerful. 


## Displaying the distribution of continuous variables
Continuous and Categorical variables naturally lend themselves to different types of graphs. 

### Histrogram: Base R offers a frequency chart of numeric variables
```{r}
hist(schools$Low_income_family)
```
### A Density plot displays similar information
```{r}
plot(density(schools$Low_income_family))
```

### Boxplots a useful for understanding the spread of the data
```{r}
boxplot(schools$Total_suspensions ~ schools$SCHOOL_LEVEL_NAME)
```
Notice anything funny about this graph? What is causing it?

To change the levels:
```{r}
schools$SCHOOL_LEVEL_NAME<-factor(schools$SCHOOL_LEVEL_NAME, levels = c("ELEMENTARY SCHOOL", "MIDDLE SCHOOL", "HIGH SCHOOL", "CAREER AND TECHNICAL HIGH SCHL"))
levels(schools$SCHOOL_LEVEL_NAME)
```

Now everything looks right!
```{r}
boxplot(schools$Total_suspensions ~ schools$SCHOOL_LEVEL_NAME)
```


## Scatter plots to display associations among continuous variables 
```{r}
plot(schools$Low_income_family, schools$Gifted_education)

plot(schools$Attendance, schools$Gifted_education, col = schools$SCHOOL_LEVEL_NAME, pch=16)
legend(x=80, y=60, legend=levels(schools$SCHOOL_LEVEL_NAME), col=c(1:4), pch=16)
```

#------------------------
# Your turn: Find something interesting to you in the data and plot it!
#------------------------

#------------------------
# Your turn: Now you will analyze a new dataset using your new skills!
# 1. Read in the csv file, "acs_orientation.csv". This file contains information on the gender, years of education, race, and income of 500 residents of Philadelphia. 
# 2. Find the number of males and females in this dataset
# 3. Find the average salary of this dataset
# 4. Find the average salary of this dataset by gender
# 5. Find the average salary of this dataset by race
# 6. Plot the relationship between years of education and income
#------------------------



